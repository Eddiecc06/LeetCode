# 3652. Best Time to Buy and Sell Stock using Strategy
[Medium](https://leetcode.com/problems/best-time-to-buy-and-sell-stock-using-strategy/description/)

## Problem Description

You are given two integer arrays prices and strategy, where:

  - prices[i] is the price of a given stock on the ith day.
  - strategy[i] represents a trading action on the ith day, where:
    - -1 indicates buying one unit of the stock.
    - 0 indicates holding the stock.
    - 1 indicates selling one unit of the stock.

You are also given an even integer k, and may perform at most one modification to strategy. A modification consists of:

  - Selecting exactly k consecutive elements in strategy.
  - Set the first k / 2 elements to 0 (hold).
  - Set the last k / 2 elements to 1 (sell).

The profit is defined as the sum of strategy[i] * prices[i] across all days.

Return the maximum possible profit you can achieve.

Note: There are no constraints on budget or stock ownership, so all buy and sell operations are feasible regardless of past actions.


**Example 1**:
```
Input: prices = [4,2,8], strategy = [-1,0,1], k = 2
Output: 10
```

<img width="488" height="210" alt="截圖 2025-08-19 晚上10 13 31" src="https://github.com/user-attachments/assets/8a66877e-342c-407f-b087-bb352a9af2ce" />

```
Thus, the maximum possible profit is 10, which is achieved by modifying the subarray [0, 1]​​​​​​​.
```
**Example 2**:
```
Input: prices = [5,4,3], strategy = [1,1,0], k = 2
Output: 9
```

<img width="488" height="210" alt="截圖 2025-08-19 晚上10 13 36" src="https://github.com/user-attachments/assets/b0bf295e-a7bc-4047-98d8-ea5eb10ab0c8" />

```
Thus, the maximum possible profit is 9, which is achieved without any modification.
```

**Constraints**
```
2 <= prices.length == strategy.length <= 10^5
1 <= prices[i] <= 10^5
-1 <= strategy[i] <= 1
2 <= k <= prices.length
k is even
```

## Solution

### _Related Topic_
   Array, Sliding Window, Prefix Sum

### _C++ Code_
```cpp
class Solution {
public:
    long long maxProfit(vector<int>& prices, vector<int>& strategy, int k) {
        long long profits = 0, maxProfits = 0;
        //original : The original profits without performing modification in the sliding window
        //change : The updated profits after performing modification to strategy
        long long original = 0, change = 0;
        int n = prices.size();
        for(int i = 0; i < n; ++i){
            if(i < k)
                original += (prices[i]*strategy[i]);
            profits += (prices[i]*strategy[i]);
        }
        maxProfits = profits;
        for(int i = k/2; i < k; ++i)
            change += prices[i];
        maxProfits = max(maxProfits, profits + change - original);
        for(int i = 0; i < n - k; ++i){
            //moving the sliding window. The value of middle element shuold be deleted.
            change = change - prices[i + k/2] + prices[k + i];
            original = original - prices[i]*strategy[i] + prices[k + i]*strategy[k + i];
            maxProfits = max(maxProfits, profits + change - original);
        }
        return maxProfits;
        
    }
};
```

### _Complexity Anlysis_
- _Time Complexity_: O(n)
- _Space Complexity_：O(1)
